name: Prepare plugin for production

on:
  pull_request:
    types:
      - opened
    branches:
      # - 'master'
      # - 'main'
      - 'dev/add-release-workflow'

jobs:
  Prepare-Plugin-For-Production:
    if: startsWith(github.head_ref, 'releases/')
    name: Pre release after testing the plugin
    runs-on: macos-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    - name: run script
      run: bash .github/bash_scripts/release.sh
    - uses: mdecoleman/pr-branch-name@1.2.0
      id: vars
      with:
        repo-token: ${{ secrets.CI_GITHUB_TOKEN }}  
    # - name: Commit changes
    #   uses: EndBug/add-and-commit@v9
    #   with:
    #     author_name: Moris Gateno
    #     author_email: moris.gateno@appsflyer.com
    #     message: 'Commited from github action - prepaing the repo for production.'
    #     add: '.'  
    - name: Commit and Push
      run : |
        git add .
        git commit -m"Commited from github action - prepaing the repo for production."
        git push origin HEAD:${{ steps.vars.outputs.branch }} --force